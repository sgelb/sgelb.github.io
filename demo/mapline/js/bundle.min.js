!function e(t,n,r){function i(a,u){if(!n[a]){if(!t[a]){var s="function"==typeof require&&require;if(!u&&s)return s(a,!0);if(o)return o(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[a]={exports:{}};t[a][0].call(c.exports,function(e){var n=t[a][1][e];return i(n?n:e)},c,c.exports,e,t,n,r)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t,n){function r(e){if(!e||!e.type)return null;var t=i[e.type];return t?"geometry"===t?{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:e}]}:"feature"===t?{type:"FeatureCollection",features:[e]}:"featurecollection"===t?e:void 0:null}t.exports=r;var i={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"}},{}],2:[function(e,t,n){"use strict";function r(e,t){return new i(e,t)}function i(e,t){if(void 0===e)throw new Error("No latitude given.");if(t&&!u[t])throw new Error("Unknown unit "+t+". Use one of: "+Object.keys(u));var n=t?u[t]:1,r=Math.cos(e*Math.PI/180),i=2*r*r-1,o=2*r*i-r,a=2*r*o-i,s=2*r*a-o;this.kx=n*(111.41513*r-.09455*o+12e-5*s),this.ky=n*(111.13209-.56605*i+.0012*a)}function o(e,t){return e[0]===t[0]&&e[1]===t[1]}function a(e,t,n){var r=t[0]-e[0],i=t[1]-e[1];return[e[0]+r*n,e[1]+i*n]}t.exports=r;var u=r.units={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254};r.fromTile=function(e,t,n){var r=Math.PI*(1-2*(e+.5)/Math.pow(2,t));return new i(180*Math.atan(.5*(Math.exp(r)-Math.exp(-r)))/Math.PI,n)},i.prototype={distance:function(e,t){var n=(e[0]-t[0])*this.kx,r=(e[1]-t[1])*this.ky;return Math.sqrt(n*n+r*r)},bearing:function(e,t){var n=(t[0]-e[0])*this.kx,r=(t[1]-e[1])*this.ky;if(!n&&!r)return 0;var i=180*Math.atan2(-r,n)/Math.PI+90;return i>180&&(i-=360),i},destination:function(e,t,n){var r=(90-n)*Math.PI/180;return this.offset(e,Math.cos(r)*t,Math.sin(r)*t)},offset:function(e,t,n){return[e[0]+t/this.kx,e[1]+n/this.ky]},lineDistance:function(e){for(var t=0,n=0;n<e.length-1;n++)t+=this.distance(e[n],e[n+1]);return t},area:function(e){for(var t=0,n=0;n<e.length;n++)for(var r=e[n],i=0,o=r.length,a=o-1;i<o;a=i++)t+=(r[i][0]-r[a][0])*(r[i][1]+r[a][1])*(n?-1:1);return Math.abs(t)/2*this.kx*this.ky},along:function(e,t){var n=0;if(t<=0)return e[0];for(var r=0;r<e.length-1;r++){var i=e[r],o=e[r+1],u=this.distance(i,o);if((n+=u)>t)return a(i,o,(t-(n-u))/u)}return e[e.length-1]},pointOnLine:function(e,t){for(var n,r,i,o,a=1/0,u=0;u<e.length-1;u++){var s=e[u][0],l=e[u][1],c=(e[u+1][0]-s)*this.kx,f=(e[u+1][1]-l)*this.ky;if(0!==c||0!==f){var d=((t[0]-s)*this.kx*c+(t[1]-l)*this.ky*f)/(c*c+f*f);d>1?(s=e[u+1][0],l=e[u+1][1]):d>0&&(s+=c/this.kx*d,l+=f/this.ky*d)}c=(t[0]-s)*this.kx,f=(t[1]-l)*this.ky;var h=c*c+f*f;h<a&&(a=h,n=s,r=l,i=u,o=d)}return{point:[n,r],index:i,t:o}},lineSlice:function(e,t,n){var r=this.pointOnLine(n,e),i=this.pointOnLine(n,t);if(r.index>i.index||r.index===i.index&&r.t>i.t){var a=r;r=i,i=a}var u=[r.point],s=r.index+1,l=i.index;!o(n[s],u[0])&&s<=l&&u.push(n[s]);for(var c=s+1;c<=l;c++)u.push(n[c]);return o(n[l],i.point)||u.push(i.point),u},lineSliceAlong:function(e,t,n){for(var r=0,i=[],o=0;o<n.length-1;o++){var u=n[o],s=n[o+1],l=this.distance(u,s);if(r+=l,r>e&&0===i.length&&i.push(a(u,s,(e-(r-l))/l)),r>=t)return i.push(a(u,s,(t-(r-l))/l)),i;r>e&&i.push(s)}return i},bufferPoint:function(e,t){var n=t/this.ky,r=t/this.kx;return[e[0]-r,e[1]-n,e[0]+r,e[1]+n]},bufferBBox:function(e,t){var n=t/this.ky,r=t/this.kx;return[e[0]-r,e[1]-n,e[2]+r,e[3]+n]},insideBBox:function(e,t){return e[0]>=t[0]&&e[0]<=t[2]&&e[1]>=t[1]&&e[1]<=t[3]}}},{}],3:[function(e,t,n){function r(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function o(e){if(f===setTimeout)return setTimeout(e,0);if((f===r||!f)&&setTimeout)return f=setTimeout,setTimeout(e,0);try{return f(e,0)}catch(t){try{return f.call(null,e,0)}catch(t){return f.call(this,e,0)}}}function a(e){if(d===clearTimeout)return clearTimeout(e);if((d===i||!d)&&clearTimeout)return d=clearTimeout,clearTimeout(e);try{return d(e)}catch(t){try{return d.call(null,e)}catch(t){return d.call(this,e)}}}function u(){g&&p&&(g=!1,p.length?m=p.concat(m):v=-1,m.length&&s())}function s(){if(!g){var e=o(u);g=!0;for(var t=m.length;t;){for(p=m,m=[];++v<t;)p&&p[v].run();v=-1,t=m.length}p=null,g=!1,a(e)}}function l(e,t){this.fun=e,this.array=t}function c(){}var f,d,h=t.exports={};!function(){try{f="function"==typeof setTimeout?setTimeout:r}catch(e){f=r}try{d="function"==typeof clearTimeout?clearTimeout:i}catch(e){d=i}}();var p,m=[],g=!1,v=-1;h.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];m.push(new l(e,t)),1!==m.length||g||o(s)},l.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=c,h.addListener=c,h.once=c,h.off=c,h.removeListener=c,h.removeAllListeners=c,h.emit=c,h.binding=function(e){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(e){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},{}],4:[function(e,t,n){function r(e){this.options=e||{locator:{}}}function i(e,t,n){function r(t){var r=e[t];!r&&a&&(r=2==e.length?function(n){e(t,n)}:e),i[t]=r&&function(e){r("[xmldom "+t+"]\t"+e+u(n))}||function(){}}if(!e){if(t instanceof o)return t;e=t}var i={},a=e instanceof Function;return n=n||{},r("warning"),r("error"),r("fatalError"),i}function o(){this.cdata=!1}function a(e,t){t.lineNumber=e.lineNumber,t.columnNumber=e.columnNumber}function u(e){if(e)return"\n@"+(e.systemId||"")+"#[line:"+e.lineNumber+",col:"+e.columnNumber+"]"}function s(e,t,n){return"string"==typeof e?e.substr(t,n):e.length>=t+n||t?new java.lang.String(e,t,n)+"":e}function l(e,t){e.currentElement?e.currentElement.appendChild(t):e.doc.appendChild(t)}r.prototype.parseFromString=function(e,t){var n=this.options,r=new c,a=n.domBuilder||new o,u=n.errorHandler,s=n.locator,l=n.xmlns||{},f={lt:"<",gt:">",amp:"&",quot:'"',apos:"'"};return s&&a.setDocumentLocator(s),r.errorHandler=i(u,a,s),r.domBuilder=n.domBuilder||a,/\/x?html?$/.test(t)&&(f.nbsp=" ",f.copy="©",l[""]="http://www.w3.org/1999/xhtml"),l.xml=l.xml||"http://www.w3.org/XML/1998/namespace",e?r.parse(e,l,f):r.errorHandler.error("invalid doc source"),a.doc},o.prototype={startDocument:function(){this.doc=(new f).createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(e,t,n,r){var i=this.doc,o=i.createElementNS(e,n||t),u=r.length;l(this,o),this.currentElement=o,this.locator&&a(this.locator,o);for(var s=0;s<u;s++){var e=r.getURI(s),c=r.getValue(s),n=r.getQName(s),f=i.createAttributeNS(e,n);this.locator&&a(r.getLocator(s),f),f.value=f.nodeValue=c,o.setAttributeNode(f)}},endElement:function(e,t,n){var r=this.currentElement;r.tagName,this.currentElement=r.parentNode},startPrefixMapping:function(e,t){},endPrefixMapping:function(e){},processingInstruction:function(e,t){var n=this.doc.createProcessingInstruction(e,t);this.locator&&a(this.locator,n),l(this,n)},ignorableWhitespace:function(e,t,n){},characters:function(e,t,n){if(e=s.apply(this,arguments)){if(this.cdata)var r=this.doc.createCDATASection(e);else var r=this.doc.createTextNode(e);this.currentElement?this.currentElement.appendChild(r):/^\s*$/.test(e)&&this.doc.appendChild(r),this.locator&&a(this.locator,r)}},skippedEntity:function(e){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(e){(this.locator=e)&&(e.lineNumber=0)},comment:function(e,t,n){e=s.apply(this,arguments);var r=this.doc.createComment(e);this.locator&&a(this.locator,r),l(this,r)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(e,t,n){var r=this.doc.implementation;if(r&&r.createDocumentType){var i=r.createDocumentType(e,t,n);this.locator&&a(this.locator,i),l(this,i)}},warning:function(e){console.warn("[xmldom warning]\t"+e,u(this.locator))},error:function(e){console.error("[xmldom error]\t"+e,u(this.locator))},fatalError:function(e){throw console.error("[xmldom fatalError]\t"+e,u(this.locator)),e}},"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(e){o.prototype[e]=function(){return null}});var c=e("./sax").XMLReader,f=n.DOMImplementation=e("./dom").DOMImplementation;n.XMLSerializer=e("./dom").XMLSerializer,n.DOMParser=r},{"./dom":5,"./sax":6}],5:[function(e,t,n){function r(e,t){for(var n in e)t[n]=e[n]}function i(e,t){function n(){}var i=e.prototype;if(Object.create){var o=Object.create(t.prototype);i.__proto__=o}i instanceof t||(n.prototype=t.prototype,n=new n,r(i,n),e.prototype=i=n),i.constructor!=e&&("function"!=typeof e&&console.error("unknow Class:"+e),i.constructor=e)}function o(e,t){if(t instanceof Error)var n=t;else n=this,Error.call(this,oe[e]),this.message=oe[e],Error.captureStackTrace&&Error.captureStackTrace(this,o);return n.code=e,t&&(this.message=this.message+": "+t),n}function a(){}function u(e,t){this._node=e,this._refresh=t,s(this)}function s(e){var t=e._node._inc||e._node.ownerDocument._inc;if(e._inc!=t){var n=e._refresh(e._node);z(e,"length",n.length),r(n,e),e._inc=t}}function l(){}function c(e,t){for(var n=e.length;n--;)if(e[n]===t)return n}function f(e,t,n,r){if(r?t[c(t,r)]=n:t[t.length++]=n,e){n.ownerElement=e;var i=e.ownerDocument;i&&(r&&b(i,e,r),y(i,e,n))}}function d(e,t,n){var r=c(t,n);if(!(r>=0))throw o(ue,new Error(e.tagName+"@"+n));for(var i=t.length-1;r<i;)t[r]=t[++r];if(t.length=i,e){var a=e.ownerDocument;a&&(b(a,e,n),n.ownerElement=null)}}function h(e){if(this._features={},e)for(var t in e)this._features=e[t]}function p(){}function m(e){return"<"==e&&"&lt;"||">"==e&&"&gt;"||"&"==e&&"&amp;"||'"'==e&&"&quot;"||"&#"+e.charCodeAt()+";"}function g(e,t){if(t(e))return!0;if(e=e.firstChild)do{if(g(e,t))return!0}while(e=e.nextSibling)}function v(){}function y(e,t,n){e&&e._inc++,"http://www.w3.org/2000/xmlns/"==n.namespaceURI&&(t._nsMap[n.prefix?n.localName:""]=n.value)}function b(e,t,n,r){e&&e._inc++,"http://www.w3.org/2000/xmlns/"==n.namespaceURI&&delete t._nsMap[n.prefix?n.localName:""]}function w(e,t,n){if(e&&e._inc){e._inc++;var r=t.childNodes;if(n)r[r.length++]=n;else{for(var i=t.firstChild,o=0;i;)r[o++]=i,i=i.nextSibling;r.length=o}}}function N(e,t){var n=t.previousSibling,r=t.nextSibling;return n?n.nextSibling=r:e.firstChild=r,r?r.previousSibling=n:e.lastChild=n,w(e.ownerDocument,e),t}function x(e,t,n){var r=t.parentNode;if(r&&r.removeChild(t),t.nodeType===ne){var i=t.firstChild;if(null==i)return t;var o=t.lastChild}else i=o=t;var a=n?n.previousSibling:e.lastChild;i.previousSibling=a,o.nextSibling=n,a?a.nextSibling=i:e.firstChild=i,null==n?e.lastChild=o:n.previousSibling=o;do{i.parentNode=e}while(i!==o&&(i=i.nextSibling));return w(e.ownerDocument||e,e),t.nodeType==ne&&(t.firstChild=t.lastChild=null),t}function _(e,t){var n=t.parentNode;if(n){var r=e.lastChild;n.removeChild(t);var r=e.lastChild}var r=e.lastChild;return t.parentNode=e,t.previousSibling=r,t.nextSibling=null,r?r.nextSibling=t:e.firstChild=t,e.lastChild=t,w(e.ownerDocument,e,t),t}function k(){this._nsMap={}}function E(){}function T(){}function S(){}function D(){}function C(){}function M(){}function A(){}function I(){}function O(){}function j(){}function L(){}function R(){}function P(e,t){var n=[],r=9==this.nodeType?this.documentElement:this,i=r.prefix,o=r.namespaceURI;if(o&&null==i){var i=r.lookupPrefix(o);if(null==i)var a=[{namespace:o,prefix:null}]}return U(this,n,e,t,a),n.join("")}function F(e,t,n){var r=e.prefix||"",i=e.namespaceURI;if(!r&&!i)return!1;if("xml"===r&&"http://www.w3.org/XML/1998/namespace"===i||"http://www.w3.org/2000/xmlns/"==i)return!1;for(var o=n.length;o--;){var a=n[o];if(a.prefix==r)return a.namespace!=i}return!0}function U(e,t,n,r,i){if(r){if(!(e=r(e)))return;if("string"==typeof e)return void t.push(e)}switch(e.nodeType){case H:i||(i=[]);var o=(i.length,e.attributes),a=o.length,u=e.firstChild,s=e.tagName;n=W===e.namespaceURI||n,t.push("<",s);for(var l=0;l<a;l++){var c=o.item(l);"xmlns"==c.prefix?i.push({prefix:c.localName,namespace:c.value}):"xmlns"==c.nodeName&&i.push({prefix:"",namespace:c.value})}for(var l=0;l<a;l++){var c=o.item(l);if(F(c,n,i)){var f=c.prefix||"",d=c.namespaceURI,h=f?" xmlns:"+f:" xmlns";t.push(h,'="',d,'"'),i.push({prefix:f,namespace:d})}U(c,t,n,r,i)}if(F(e,n,i)){var f=e.prefix||"",d=e.namespaceURI,h=f?" xmlns:"+f:" xmlns";t.push(h,'="',d,'"'),i.push({prefix:f,namespace:d})}if(u||n&&!/^(?:meta|link|img|br|hr|input)$/i.test(s)){if(t.push(">"),n&&/^script$/i.test(s))for(;u;)u.data?t.push(u.data):U(u,t,n,r,i),u=u.nextSibling;else for(;u;)U(u,t,n,r,i),u=u.nextSibling;t.push("</",s,">")}else t.push("/>");return;case ee:case ne:for(var u=e.firstChild;u;)U(u,t,n,r,i),u=u.nextSibling;return;case X:return t.push(" ",e.name,'="',e.value.replace(/[<&"]/g,m),'"');case G:return t.push(e.data.replace(/[<&]/g,m));case Y:return t.push("<![CDATA[",e.data,"]]>");case K:return t.push("<!--",e.data,"-->");case te:var p=e.publicId,g=e.systemId;if(t.push("<!DOCTYPE ",e.name),p)t.push(' PUBLIC "',p),g&&"."!=g&&t.push('" "',g),t.push('">');else if(g&&"."!=g)t.push(' SYSTEM "',g,'">');else{var v=e.internalSubset;v&&t.push(" [",v,"]"),t.push(">")}return;case Q:return t.push("<?",e.target," ",e.data,"?>");case Z:return t.push("&",e.nodeName,";");default:t.push("??",e.nodeName)}}function B(e,t,n){var r;switch(t.nodeType){case H:r=t.cloneNode(!1),r.ownerDocument=e;case ne:break;case X:n=!0}if(r||(r=t.cloneNode(!1)),r.ownerDocument=e,r.parentNode=null,n)for(var i=t.firstChild;i;)r.appendChild(B(e,i,n)),i=i.nextSibling;return r}function q(e,t,n){var r=new t.constructor;for(var i in t){var o=t[i];"object"!=typeof o&&o!=r[i]&&(r[i]=o)}switch(t.childNodes&&(r.childNodes=new a),r.ownerDocument=e,r.nodeType){case H:var u=t.attributes,s=r.attributes=new l,c=u.length;s._ownerElement=r;for(var f=0;f<c;f++)r.setAttributeNode(q(e,u.item(f),!0));break;case X:n=!0}if(n)for(var d=t.firstChild;d;)r.appendChild(q(e,d,n)),d=d.nextSibling;return r}function z(e,t,n){e[t]=n}function V(e){switch(e.nodeType){case H:case ne:var t=[];for(e=e.firstChild;e;)7!==e.nodeType&&8!==e.nodeType&&t.push(V(e)),e=e.nextSibling;return t.join("");default:return e.nodeValue}}var W="http://www.w3.org/1999/xhtml",$={},H=$.ELEMENT_NODE=1,X=$.ATTRIBUTE_NODE=2,G=$.TEXT_NODE=3,Y=$.CDATA_SECTION_NODE=4,Z=$.ENTITY_REFERENCE_NODE=5,J=$.ENTITY_NODE=6,Q=$.PROCESSING_INSTRUCTION_NODE=7,K=$.COMMENT_NODE=8,ee=$.DOCUMENT_NODE=9,te=$.DOCUMENT_TYPE_NODE=10,ne=$.DOCUMENT_FRAGMENT_NODE=11,re=$.NOTATION_NODE=12,ie={},oe={},ae=(ie.INDEX_SIZE_ERR=(oe[1]="Index size error",1),ie.DOMSTRING_SIZE_ERR=(oe[2]="DOMString size error",2),ie.HIERARCHY_REQUEST_ERR=(oe[3]="Hierarchy request error",3)),ue=(ie.WRONG_DOCUMENT_ERR=(oe[4]="Wrong document",4),ie.INVALID_CHARACTER_ERR=(oe[5]="Invalid character",5),ie.NO_DATA_ALLOWED_ERR=(oe[6]="No data allowed",6),ie.NO_MODIFICATION_ALLOWED_ERR=(oe[7]="No modification allowed",7),ie.NOT_FOUND_ERR=(oe[8]="Not found",8)),se=(ie.NOT_SUPPORTED_ERR=(oe[9]="Not supported",9),ie.INUSE_ATTRIBUTE_ERR=(oe[10]="Attribute in use",10));ie.INVALID_STATE_ERR=(oe[11]="Invalid state",11),ie.SYNTAX_ERR=(oe[12]="Syntax error",12),ie.INVALID_MODIFICATION_ERR=(oe[13]="Invalid modification",13),ie.NAMESPACE_ERR=(oe[14]="Invalid namespace",14),ie.INVALID_ACCESS_ERR=(oe[15]="Invalid access",15);o.prototype=Error.prototype,r(ie,o),a.prototype={length:0,item:function(e){return this[e]||null},toString:function(e,t){for(var n=[],r=0;r<this.length;r++)U(this[r],n,e,t);return n.join("")}},u.prototype.item=function(e){return s(this),this[e]},i(u,a),l.prototype={length:0,item:a.prototype.item,getNamedItem:function(e){for(var t=this.length;t--;){var n=this[t];if(n.nodeName==e)return n}},setNamedItem:function(e){var t=e.ownerElement;if(t&&t!=this._ownerElement)throw new o(se);var n=this.getNamedItem(e.nodeName);return f(this._ownerElement,this,e,n),n},setNamedItemNS:function(e){var t,n=e.ownerElement;if(n&&n!=this._ownerElement)throw new o(se);return t=this.getNamedItemNS(e.namespaceURI,e.localName),f(this._ownerElement,this,e,t),t},removeNamedItem:function(e){var t=this.getNamedItem(e);return d(this._ownerElement,this,t),t},removeNamedItemNS:function(e,t){var n=this.getNamedItemNS(e,t);return d(this._ownerElement,this,n),n},getNamedItemNS:function(e,t){for(var n=this.length;n--;){var r=this[n];if(r.localName==t&&r.namespaceURI==e)return r}return null}},h.prototype={hasFeature:function(e,t){var n=this._features[e.toLowerCase()];return!(!n||t&&!(t in n))},createDocument:function(e,t,n){var r=new v;if(r.implementation=this,r.childNodes=new a,r.doctype=n,n&&r.appendChild(n),t){var i=r.createElementNS(e,t);r.appendChild(i)}return r},createDocumentType:function(e,t,n){var r=new M;return r.name=e,r.nodeName=e,r.publicId=t,r.systemId=n,r}},p.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(e,t){return x(this,e,t)},replaceChild:function(e,t){this.insertBefore(e,t),t&&this.removeChild(t)},removeChild:function(e){return N(this,e)},appendChild:function(e){return this.insertBefore(e,null)},hasChildNodes:function(){return null!=this.firstChild},cloneNode:function(e){return q(this.ownerDocument||this,this,e)},normalize:function(){for(var e=this.firstChild;e;){var t=e.nextSibling;t&&t.nodeType==G&&e.nodeType==G?(this.removeChild(t),e.appendData(t.data)):(e.normalize(),e=t)}},isSupported:function(e,t){return this.ownerDocument.implementation.hasFeature(e,t)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(e){for(var t=this;t;){var n=t._nsMap;if(n)for(var r in n)if(n[r]==e)return r;t=t.nodeType==X?t.ownerDocument:t.parentNode}return null},lookupNamespaceURI:function(e){for(var t=this;t;){var n=t._nsMap;if(n&&e in n)return n[e];t=t.nodeType==X?t.ownerDocument:t.parentNode}return null},isDefaultNamespace:function(e){return null==this.lookupPrefix(e)}},r($,p),r($,p.prototype),v.prototype={nodeName:"#document",nodeType:ee,doctype:null,documentElement:null,_inc:1,insertBefore:function(e,t){if(e.nodeType==ne){for(var n=e.firstChild;n;){var r=n.nextSibling;this.insertBefore(n,t),n=r}return e}return null==this.documentElement&&e.nodeType==H&&(this.documentElement=e),x(this,e,t),e.ownerDocument=this,e},removeChild:function(e){return this.documentElement==e&&(this.documentElement=null),N(this,e)},importNode:function(e,t){return B(this,e,t)},getElementById:function(e){var t=null;return g(this.documentElement,function(n){if(n.nodeType==H&&n.getAttribute("id")==e)return t=n,!0}),t},createElement:function(e){var t=new k;return t.ownerDocument=this,t.nodeName=e,t.tagName=e,t.childNodes=new a,(t.attributes=new l)._ownerElement=t,t},createDocumentFragment:function(){var e=new j;return e.ownerDocument=this,e.childNodes=new a,e},createTextNode:function(e){var t=new S;return t.ownerDocument=this,t.appendData(e),t},createComment:function(e){var t=new D;return t.ownerDocument=this,t.appendData(e),t},createCDATASection:function(e){var t=new C;return t.ownerDocument=this,t.appendData(e),t},createProcessingInstruction:function(e,t){var n=new L;return n.ownerDocument=this,n.tagName=n.target=e,n.nodeValue=n.data=t,n},createAttribute:function(e){var t=new E;return t.ownerDocument=this,t.name=e,t.nodeName=e,t.localName=e,t.specified=!0,t},createEntityReference:function(e){var t=new O;return t.ownerDocument=this,t.nodeName=e,t},createElementNS:function(e,t){var n=new k,r=t.split(":"),i=n.attributes=new l;return n.childNodes=new a,n.ownerDocument=this,n.nodeName=t,n.tagName=t,n.namespaceURI=e,2==r.length?(n.prefix=r[0],n.localName=r[1]):n.localName=t,i._ownerElement=n,n},createAttributeNS:function(e,t){var n=new E,r=t.split(":");return n.ownerDocument=this,n.nodeName=t,n.name=t,n.namespaceURI=e,n.specified=!0,2==r.length?(n.prefix=r[0],n.localName=r[1]):n.localName=t,n}},i(v,p),k.prototype={nodeType:H,hasAttribute:function(e){return null!=this.getAttributeNode(e)},getAttribute:function(e){var t=this.getAttributeNode(e);return t&&t.value||""},getAttributeNode:function(e){return this.attributes.getNamedItem(e)},setAttribute:function(e,t){var n=this.ownerDocument.createAttribute(e);n.value=n.nodeValue=""+t,this.setAttributeNode(n)},removeAttribute:function(e){var t=this.getAttributeNode(e);t&&this.removeAttributeNode(t)},appendChild:function(e){return e.nodeType===ne?this.insertBefore(e,null):_(this,e)},setAttributeNode:function(e){return this.attributes.setNamedItem(e)},setAttributeNodeNS:function(e){return this.attributes.setNamedItemNS(e)},removeAttributeNode:function(e){return this.attributes.removeNamedItem(e.nodeName)},removeAttributeNS:function(e,t){var n=this.getAttributeNodeNS(e,t);n&&this.removeAttributeNode(n)},hasAttributeNS:function(e,t){return null!=this.getAttributeNodeNS(e,t)},getAttributeNS:function(e,t){var n=this.getAttributeNodeNS(e,t);return n&&n.value||""},setAttributeNS:function(e,t,n){var r=this.ownerDocument.createAttributeNS(e,t);r.value=r.nodeValue=""+n,this.setAttributeNode(r)},getAttributeNodeNS:function(e,t){return this.attributes.getNamedItemNS(e,t)},getElementsByTagName:function(e){return new u(this,function(t){var n=[];return g(t,function(r){r===t||r.nodeType!=H||"*"!==e&&r.tagName!=e||n.push(r)}),n})},getElementsByTagNameNS:function(e,t){return new u(this,function(n){var r=[];return g(n,function(i){i===n||i.nodeType!==H||"*"!==e&&i.namespaceURI!==e||"*"!==t&&i.localName!=t||r.push(i)}),r})}},v.prototype.getElementsByTagName=k.prototype.getElementsByTagName,v.prototype.getElementsByTagNameNS=k.prototype.getElementsByTagNameNS,i(k,p),E.prototype.nodeType=X,i(E,p),T.prototype={data:"",substringData:function(e,t){return this.data.substring(e,e+t)},appendData:function(e){e=this.data+e,this.nodeValue=this.data=e,this.length=e.length},insertData:function(e,t){this.replaceData(e,0,t)},appendChild:function(e){throw new Error(oe[ae])},deleteData:function(e,t){this.replaceData(e,t,"")},replaceData:function(e,t,n){n=this.data.substring(0,e)+n+this.data.substring(e+t),this.nodeValue=this.data=n,this.length=n.length}},i(T,p),S.prototype={nodeName:"#text",nodeType:G,splitText:function(e){var t=this.data,n=t.substring(e);t=t.substring(0,e),this.data=this.nodeValue=t,this.length=t.length;var r=this.ownerDocument.createTextNode(n);return this.parentNode&&this.parentNode.insertBefore(r,this.nextSibling),r}},i(S,T),D.prototype={nodeName:"#comment",nodeType:K},i(D,T),C.prototype={nodeName:"#cdata-section",nodeType:Y},i(C,T),M.prototype.nodeType=te,i(M,p),A.prototype.nodeType=re,i(A,p),I.prototype.nodeType=J,i(I,p),O.prototype.nodeType=Z,i(O,p),j.prototype.nodeName="#document-fragment",j.prototype.nodeType=ne,i(j,p),L.prototype.nodeType=Q,i(L,p),R.prototype.serializeToString=function(e,t,n){return P.call(e,t,n)},p.prototype.toString=P;try{Object.defineProperty&&(Object.defineProperty(u.prototype,"length",{get:function(){return s(this),this.$$length}}),Object.defineProperty(p.prototype,"textContent",{get:function(){return V(this)},set:function(e){switch(this.nodeType){case H:case ne:for(;this.firstChild;)this.removeChild(this.firstChild);(e||String(e))&&this.appendChild(this.ownerDocument.createTextNode(e));break;default:this.data=e,this.value=e,this.nodeValue=e}}}),z=function(e,t,n){e["$$"+t]=n})}catch(e){}n.DOMImplementation=h,n.XMLSerializer=R},{}],6:[function(e,t,n){function r(){}function i(e,t,n,r,i){function c(e){if(e>65535){e-=65536;var t=55296+(e>>10),n=56320+(1023&e);return String.fromCharCode(t,n)}return String.fromCharCode(e)}function p(e){var t=e.slice(1,-1);return t in n?n[t]:"#"===t.charAt(0)?c(parseInt(t.substr(1).replace("x","0x"))):(i.error("entity not found:"+e),e)}function m(t){if(t>_){var n=e.substring(_,t).replace(/&#?\w+;/g,p);w&&g(_),r.characters(n,0,t-_),_=t}}function g(t,n){for(;t>=y&&(n=b.exec(e));)v=n.index,y=v+n[0].length,w.lineNumber++;w.columnNumber=t-v+1}for(var v=0,y=0,b=/.*(?:\r\n?|\n)|.*$/g,w=r.locator,N=[{currentNSMap:t}],x={},_=0;;){try{var k=e.indexOf("<",_);if(k<0){if(!e.substr(_).match(/^\s*$/)){var E=r.doc,T=E.createTextNode(e.substr(_));E.appendChild(T),r.currentElement=T}return}switch(k>_&&m(k),e.charAt(k+1)){case"/":var S=e.indexOf(">",k+3),D=e.substring(k+2,S),C=N.pop();S<0?(D=e.substring(k+2).replace(/[\s<].*/,""),i.error("end tag name: "+D+" is not complete:"+C.tagName),S=k+1+D.length):D.match(/\s</)&&(D=D.replace(/[\s<].*/,""),i.error("end tag name: "+D+" maybe not complete"),S=k+1+D.length);var M=C.localNSMap,A=C.tagName==D;if(A||C.tagName&&C.tagName.toLowerCase()==D.toLowerCase()){if(r.endElement(C.uri,C.localName,D),M)for(var I in M)r.endPrefixMapping(I);A||i.fatalError("end tag name: "+D+" is not match the current start tagName:"+C.tagName)}else N.push(C);S++;break;case"?":w&&g(k),S=d(e,k,r);break;case"!":w&&g(k),S=f(e,k,r,i);break;default:w&&g(k);var O=new h,j=N[N.length-1].currentNSMap,S=a(e,k,O,j,p,i),L=O.length;if(!O.closed&&l(e,S,O.tagName,x)&&(O.closed=!0,n.nbsp||i.warning("unclosed xml attribute")),w&&L){for(var R=o(w,{}),P=0;P<L;P++){var F=O[P];g(F.offset),F.locator=o(w,{})}r.locator=R,u(O,r,j)&&N.push(O),r.locator=w}else u(O,r,j)&&N.push(O);"http://www.w3.org/1999/xhtml"!==O.uri||O.closed?S++:S=s(e,S,O.tagName,p,r)}}catch(e){i.error("element parse error: "+e),S=-1}S>_?_=S:m(Math.max(k,_)+1)}}function o(e,t){return t.lineNumber=e.lineNumber,t.columnNumber=e.columnNumber,t}function a(e,t,n,r,i,o){for(var a,u,s=++t,l=b;;){var c=e.charAt(s);switch(c){case"=":if(l===w)a=e.slice(t,s),l=x;else{if(l!==N)throw new Error("attribute equal must after attrName");l=x}break;case"'":case'"':if(l===x||l===w){if(l===w&&(o.warning('attribute value must after "="'),a=e.slice(t,s)),t=s+1,!((s=e.indexOf(c,t))>0))throw new Error("attribute value no end '"+c+"' match");u=e.slice(t,s).replace(/&#?\w+;/g,i),n.add(a,u,t-1),l=k}else{if(l!=_)throw new Error('attribute value must after "="');u=e.slice(t,s).replace(/&#?\w+;/g,i),n.add(a,u,t),o.warning('attribute "'+a+'" missed start quot('+c+")!!"),t=s+1,l=k}break;case"/":switch(l){case b:n.setTagName(e.slice(t,s));case k:case E:case T:l=T,n.closed=!0;case _:case w:case N:break;default:throw new Error("attribute invalid close char('/')")}break;case"":return o.error("unexpected end of input"),l==b&&n.setTagName(e.slice(t,s)),s;case">":switch(l){case b:n.setTagName(e.slice(t,s));case k:case E:case T:break;case _:case w:u=e.slice(t,s),"/"===u.slice(-1)&&(n.closed=!0,u=u.slice(0,-1));case N:l===N&&(u=a),l==_?(o.warning('attribute "'+u+'" missed quot(")!!'),n.add(a,u.replace(/&#?\w+;/g,i),t)):("http://www.w3.org/1999/xhtml"===r[""]&&u.match(/^(?:disabled|checked|selected)$/i)||o.warning('attribute "'+u+'" missed value!! "'+u+'" instead!!'),n.add(u,u,t));break;case x:throw new Error("attribute value missed!!")}return s;case"":c=" ";default:if(c<=" ")switch(l){case b:n.setTagName(e.slice(t,s)),l=E;break;case w:a=e.slice(t,s),l=N;break;case _:var u=e.slice(t,s).replace(/&#?\w+;/g,i);o.warning('attribute "'+u+'" missed quot(")!!'),n.add(a,u,t);case k:l=E}else switch(l){case N:n.tagName,"http://www.w3.org/1999/xhtml"===r[""]&&a.match(/^(?:disabled|checked|selected)$/i)||o.warning('attribute "'+a+'" missed value!! "'+a+'" instead2!!'),n.add(a,a,t),t=s,l=w;break;case k:o.warning('attribute space is required"'+a+'"!!');case E:l=w,t=s;break;case x:l=_,t=s;break;case T:throw new Error("elements closed character '/' and '>' must be connected to")}}s++}}function u(e,t,n){for(var r=e.tagName,i=null,o=e.length;o--;){var a=e[o],u=a.qName,s=a.value,l=u.indexOf(":");if(l>0)var f=a.prefix=u.slice(0,l),d=u.slice(l+1),h="xmlns"===f&&d;else d=u,f=null,h="xmlns"===u&&"";a.localName=d,h!==!1&&(null==i&&(i={},c(n,n={})),n[h]=i[h]=s,a.uri="http://www.w3.org/2000/xmlns/",t.startPrefixMapping(h,s))}for(var o=e.length;o--;){a=e[o];var f=a.prefix;f&&("xml"===f&&(a.uri="http://www.w3.org/XML/1998/namespace"),"xmlns"!==f&&(a.uri=n[f||""]))}var l=r.indexOf(":");l>0?(f=e.prefix=r.slice(0,l),d=e.localName=r.slice(l+1)):(f=null,d=e.localName=r);var p=e.uri=n[f||""];if(t.startElement(p,d,r,e),!e.closed)return e.currentNSMap=n,e.localNSMap=i,!0;if(t.endElement(p,d,r),i)for(f in i)t.endPrefixMapping(f)}function s(e,t,n,r,i){if(/^(?:script|textarea)$/i.test(n)){var o=e.indexOf("</"+n+">",t),a=e.substring(t+1,o);if(/[&<]/.test(a))return/^script$/i.test(n)?(i.characters(a,0,a.length),o):(a=a.replace(/&#?\w+;/g,r),i.characters(a,0,a.length),o)}return t+1}function l(e,t,n,r){var i=r[n];return null==i&&(i=e.lastIndexOf("</"+n+">"),i<t&&(i=e.lastIndexOf("</"+n)),r[n]=i),i<t}function c(e,t){for(var n in e)t[n]=e[n]}function f(e,t,n,r){switch(e.charAt(t+2)){case"-":if("-"===e.charAt(t+3)){var i=e.indexOf("-->",t+4);return i>t?(n.comment(e,t+4,i-t-4),i+3):(r.error("Unclosed comment"),-1)}return-1;default:if("CDATA["==e.substr(t+3,6)){var i=e.indexOf("]]>",t+9);return n.startCDATA(),n.characters(e,t+9,i-t-9),n.endCDATA(),i+3}var o=m(e,t),a=o.length;if(a>1&&/!doctype/i.test(o[0][0])){var u=o[1][0],s=a>3&&/^public$/i.test(o[2][0])&&o[3][0],l=a>4&&o[4][0],c=o[a-1];return n.startDTD(u,s&&s.replace(/^(['"])(.*?)\1$/,"$2"),l&&l.replace(/^(['"])(.*?)\1$/,"$2")),n.endDTD(),c.index+c[0].length}}return-1}function d(e,t,n){var r=e.indexOf("?>",t);if(r){var i=e.substring(t,r).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);return i?(i[0].length,n.processingInstruction(i[1],i[2]),r+2):-1}return-1}function h(e){}function p(e,t){return e.__proto__=t,e}function m(e,t){var n,r=[],i=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(i.lastIndex=t,i.exec(e);n=i.exec(e);)if(r.push(n),n[1])return r}var g=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,v=new RegExp("[\\-\\.0-9"+g.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),y=new RegExp("^"+g.source+v.source+"*(?::"+g.source+v.source+"*)?$"),b=0,w=1,N=2,x=3,_=4,k=5,E=6,T=7;r.prototype={parse:function(e,t,n){var r=this.domBuilder;r.startDocument(),c(t,t={}),i(e,t,n,r,this.errorHandler),r.endDocument()}},h.prototype={setTagName:function(e){if(!y.test(e))throw new Error("invalid tagName:"+e);this.tagName=e},add:function(e,t,n){if(!y.test(e))throw new Error("invalid attribute:"+e);this[this.length++]={qName:e,value:t,offset:n}},length:0,getLocalName:function(e){return this[e].localName},getLocator:function(e){return this[e].locator},getQName:function(e){return this[e].qName},getURI:function(e){return this[e].uri},getValue:function(e){return this[e].value}},p({},p.prototype)instanceof p||(p=function(e,t){function n(){}n.prototype=t,n=new n;for(t in e)n[t]=e[t];return n}),n.XMLReader=r},{}],7:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var a,u=e[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{!r&&u.return&&u.return()}finally{if(i)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e("cheap-ruler"),u=function(e){return e&&e.__esModule?e:{default:e}}(a),s=function(){
function e(t){r(this,e),this._lat=t,this._ruler=(0,u.default)(t,"meters"),this.bounds=new mapboxgl.LngLatBounds}return o(e,[{key:"_dimensions",value:function(){return[this._ruler.distance([this.bounds.getWest(),this.bounds.getNorth()],[this.bounds.getEast(),this.bounds.getNorth()]),this._ruler.distance([this.bounds.getWest(),this.bounds.getNorth()],[this.bounds.getWest(),this.bounds.getSouth()])]}},{key:"_linestring",value:function(){return[[this.bounds.getWest(),this.bounds.getNorth()],[this.bounds.getEast(),this.bounds.getNorth()],[this.bounds.getEast(),this.bounds.getSouth()],[this.bounds.getWest(),this.bounds.getSouth()],[this.bounds.getWest(),this.bounds.getNorth()]]}},{key:"extend",value:function(e){this.bounds.extend(e.slice(0,2))}},{key:"largerThan",value:function(e,t){var n=this._dimensions(),r=i(n,2),o=r[0],a=r[1];return(o>e||a>t)&&(a>e||o>t)}},{key:"resize",value:function(e,t){var n=this._dimensions(),r=i(n,2),o=r[0],a=r[1],u=.5*(e-o),s=.5*(t-a);a<o&&(u=.5*(t-o),s=.5*(e-a));var l=this._ruler.destination([this.bounds.getWest(),this.bounds.getNorth()],u,270)[0],c=this._ruler.destination([this.bounds.getWest(),this.bounds.getSouth()],s,180)[1],f=this._ruler.destination([this.bounds.getEast(),this.bounds.getNorth()],u,90)[0],d=this._ruler.destination([this.bounds.getWest(),this.bounds.getNorth()],s,0)[1];this.bounds.setSouthWest([l,c]),this.bounds.setNorthEast([f,d])}},{key:"revertTo",value:function(e){this.bounds=e}},{key:"toFeature",value:function(){var e=this._dimensions(),t=i(e,2),n=t[0],r=t[1];return{type:"Feature",bbox:this.bounds,geometry:{type:"Polygon",coordinates:[this._linestring()]},properties:{width:n,height:r}}}}]),e}();n.default=s},{"cheap-ruler":2}],8:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var a,u=e[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{!r&&u.return&&u.return()}finally{if(i)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(){r(this,e),this._validity=new Map,this._enablees=[]}return o(e,[{key:"enableWhenAllValid",value:function(e){this._enablees.push(e)}},{key:"add",value:function(e){e.form.parentNode.nextElementSibling.innerHTML=e.msg||"",this._validity.set(e.form.id,!0),this._addEventListener(e)}},{key:"allValid",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,i=this._validity.values()[Symbol.iterator]();!(e=(r=i.next()).done);e=!0)if(r.value===!1)return!1}catch(e){t=!0,n=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw n}}return!0}},{key:"resetInvalidForms",value:function(){if(!this.allValid()){var e=!0,t=!1,n=void 0;try{for(var r,o=this._validity[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var a=i(r.value,2),u=a[0];if(a[1]===!1){var s=document.getElementById(u);s.value=s.defaultValue,this._validation(!0,s)}}}catch(e){t=!0,n=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw n}}}}},{key:"_addEventListener",value:function(e){var t=this;e.form.addEventListener("input",function(){t._validation(e.validity(e.form.value),e.form)})}},{key:"_validation",value:function(e,t){var n=t.parentNode;e?(n.parentNode.classList.remove("has-danger"),n.nextElementSibling.classList.add("hidden"),this._validity.set(t.id,!0),this._unlock()):(n.parentNode.classList.add("has-danger"),n.nextElementSibling.classList.remove("hidden"),this._validity.set(t.id,!1),this._lock())}},{key:"_unlock",value:function(){this.allValid()&&this._enablees.forEach(function(e){return e.removeAttribute("disabled")})}},{key:"_lock",value:function(){this._enablees.forEach(function(e){return e.setAttribute("disabled","true")})}}]),e}();n.default=a},{}],9:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e){var t=e.name,n=new FileReader;n.onload=function(){try{k.loadRoute(n.result,t)}catch(e){return void h("Loading "+t+" failed. "+e.message)}k.updateCutouts({scale:E.scale.value,format:E.paperformat.value,margin:E.margin.value,padding:10}),k.updateMilemarkers(E.milemarkers.value),k.updateBounds({padding:10}),o(),s(),E.trackFileName.value=k.routeName()||t},n.readAsText(e)}function o(){E.querySelectorAll(".hidable").forEach(function(e){return e.classList.toggle("hidden")}),E.querySelectorAll(".disableable").forEach(function(e){return u(e)}),a()}function a(){T.hasAttribute("disabled")?S.allValid()&&T.removeAttribute("disabled"):T.setAttribute("disabled",!0)}function u(e){e.hasAttribute("disabled")?e.removeAttribute("disabled"):e.setAttribute("disabled",!0)}function s(e){var t=E.querySelector("#trackDetailsTable");t.innerHTML="";var n=!0,r=!1,i=void 0;try{for(var o,a=k.getDetails()[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var u=m(o.value,2),s=u[0],l=u[1],c=t.insertRow();c.insertCell(0).innerHTML=s,c.insertCell(1).innerHTML=l}}catch(e){r=!0,i=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}}function l(){S.allValid()&&(k.updateCutouts({scale:E.scale.value,format:E.paperformat.value,margin:E.margin.value,padding:10}),s())}function c(){var e=new v.default,t=f(e);e.generatePDF(k.copyTo("hidden-map"),{format:E.paperformat.value,margin:parseInt(E.margin.value,10),dpi:300},t)}function f(e){var t=document.querySelector("#progress-text"),n=document.querySelector("#progress-bar"),r=document.querySelector("#modal"),i=document.querySelector("#modal-overlay"),o=document.querySelector("#cancel-button");return r.classList.remove("hidden"),i.classList.remove("hidden"),o.addEventListener("click",function(){e.cancel()}),function(e,o,a){var u=Math.trunc(100/o*(e+1))+"%";n.style.width=u,n.innerHTML=u;var s="Map "+(e+1)+" of "+o;a&&(s="Canceling"),e===o&&(r.classList.add("hidden"),i.classList.add("hidden")),t.innerHTML=s}}function d(e){return"mapbox://styles/mapbox/"+e+"-v9?optimize=true"}function h(e){var t=document.getElementById("alertbox");t.querySelector(".close").addEventListener("click",function(){t.classList.add("hidden")}),t.querySelector("#alert-msg").innerHTML=e,t.classList.remove("hidden")}function p(e){return e[0].toUpperCase()+e.slice(1)}var m=function(){function e(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var a,u=e[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{!r&&u.return&&u.return()}finally{if(i)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),g=e("./printmap.js"),v=r(g),y=e("./paperformat.js"),b=r(y),w=e("./mapbox.js"),N=r(w),x=e("./formvalidator.js"),_=r(x),k=void 0,E=document.getElementById("config"),T=document.getElementById("generate-btn"),S=new _.default;S.enableWhenAllValid(T),function(){var e=document.createElement("canvas"),t=e.getContext("webgl")||e.getContext("experimental-webgl"),n=25.4*t.getParameter(t.MAX_RENDERBUFFER_SIZE)/300/3.125,r=b.default.validFormats(n);if(r.length<1)return h("Sorry, your device does not support rendering of high-res maps.\n    Please try again using a device with a more powerful graphics card."),void document.querySelector("#main").classList.add("hidden");r.length<2&&h("Sorry, you can only create maps in "+p(r[0])+"\n    format. Please try again using a device with a more powerful graphics card.");var i=E.paperformat;i.remove(0),r.forEach(function(e){var t=document.createElement("option");t.text=p(e),t.value=e,i.add(t)}),i.value=r.includes("a5")?"a5":r[r.length-1]}();try{k=new N.default({container:"map",style:d("outdoors"),center:[13.463,47.386],zoom:11})}catch(e){h("Initiating MapboxGL failed. "+e)}E.trackFile.addEventListener("change",function(){i(this.files[0]),this.value=null}),E.querySelector("#remove-track").addEventListener("click",function(){S.resetInvalidForms(),o(),k.clearTracks()}),E.style.addEventListener("change",function(){k.style=d(this.value)}),E.scale.addEventListener("change",function(){return l()}),S.add({form:E.scale,validity:function(e){return e>=5e3},msg:"Scale must be 5000 or larger!"}),E.paperformat.addEventListener("change",function(){return l()}),E.margin.addEventListener("change",function(){return l()}),S.add({form:E.margin,validity:function(e){return e>=0&&e<=50},msg:"Margin must be between 0 and 50!"}),E.milemarkers.addEventListener("change",function(){return k.updateMilemarkers(E.milemarkers.value)}),S.add({form:E.milemarkers,validity:function(e){return e>=0},msg:"Milemarkers must be 0 or larger!"}),T.addEventListener("click",c)},{"./formvalidator.js":8,"./mapbox.js":11,"./paperformat.js":14,"./printmap.js":15}],10:[function(e,t,n){"use strict";function r(e,t){return e.getSource(t)}function i(e,t){e.addSource(t,{type:"geojson",data:o()})}function o(){return{type:"FeatureCollection",features:[]}}Object.defineProperty(n,"__esModule",{value:!0});var a={add:function(e,t){var n=t.id;r(e,n)||(i(e,n),e.addLayer(t.layer,t.before))}};n.default=a},{}],11:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t,n){e.style.width=a(t),e.style.height=a(n)}function a(e){return 96/25.4*e+"px"}Object.defineProperty(n,"__esModule",{value:!0});var u=function(){function e(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var a,u=e[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{!r&&u.return&&u.return()}finally{if(i)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e("./mapcutter.js"),c=r(l),f=e("./mapboxtoken.js"),d=r(f),h=e("./layers.js"),p=r(h),m=e("./trackutils.js"),g=r(m),v=e("./paperformat.js"),y=r(v),b=e("./track.js"),w=function(){function e(t,n,r){var o=this;if(i(this,e),mapboxgl.accessToken=d.default,!mapboxgl.supported())throw Error("Your browser does not support MapboxGL.");this._tracks=n||new Map,this._details=r||{},this._map=new mapboxgl.Map(t),this._map.on("styledata",function(){return o._updateAllTracks()}),this._addControls()}return s(e,[{key:"_addControls",value:function(){this._map.addControl(new mapboxgl.NavigationControl,"top-right"),this._map.addControl(new mapboxgl.ScaleControl)}},{key:"_updateAllTracks",value:function(){var e=this;this._tracks.forEach(function(t){e.addTrack(t),e.updateTrack(t)})}},{key:"addTrack",value:function(e){this._tracks.set(e.id,e),p.default.add(this._map,e)}},{key:"updateTrack",value:function(e){this._map.getSource(e.id).setData(e.geojson)}},{key:"loadRoute",value:function(e,t){var n=t.split(".").pop().toLowerCase();this._details.filename=t.substring(0,t.lastIndexOf("."));var r=g.default.togeojson(n,e);r=g.default.reduce(r),this.addTrack(new b.Route("route",r)),this.updateTrack(this._tracks.get("route"));var i=g.default.elevation(r),o=u(i,2);this._details.climb=o[0],this._details.descent=o[1],this._details.distance=g.default.totalDistance(r)}},{key:"_formatDetail",value:function(e,t,n){return void 0!==e?""+e.toFixed(t)+n:"unknown"}},{key:"getDetails",value:function(){var e=new Map;return e.set("Length",this._formatDetail(this._details.distance,2,"km")),e.set("Map sheets",this._details.mapCount),e}},{key:"getPrintDetails",value:function(){var e=this.getDetails(),t=this.cutouts.features,n=this._tracks.get("route").geojson,r=e.get("Map sheets"),i=this._formatDetail;return function(o){var a=g.default.distanceInBounds(t[o-1],n),s=u(a,2),l=s[0],c=s[1],f="Map "+o+" of "+r;return f+=" · "+i(l,2,"km"),f+=" · "+i(c,2,"km")+" of "+e.get("Length")+" total"}}},{key:"updateCutouts",value:function(e){this.addTrack(new b.Cutouts("cutouts",(0,c.default)(this._tracks.get("route").geojson,e))),this.updateTrack(this._tracks.get("cutouts")),this._details.mapCount=this._tracks.get("cutouts").features.length}},{key:"updateMilemarkers",value:function(e){this.addTrack(new b.Milemarkers("milemarkers",g.default.milemarkers(this._tracks.get("route").geojson,e))),this.updateTrack(this._tracks.get("milemarkers"))}},{key:"updateBounds",value:function(e){this._map.fitBounds(g.default.bounds(this._tracks.get("cutouts").geojson),e)}},{key:"routeName",value:function(){return this._tracks.get("route").geojson.features[0].properties.name||this.name}},{key:"clearTracks",value:function(){var e=this;this._tracks.forEach(function(t){return t.clearLayerData(e._map)})}},{key:"copyTo",value:function(t){return new e({container:t,style:this._map.getStyle(),interactive:!1,renderWorldCopies:!1},this._tracks,this._details)}},{key:"remove",value:function(){this._map.remove()}},{key:"cutoutMap",value:function(e,t,n){var r=e.properties.width>e.properties.height?"l":"p",i=y.default.dimensions(t,n,r),a=u(i,2),s=a[0],l=a[1],c=this.getPrintDetails(),f=this._map;return new Promise(function(i,a){o(f.getContainer(),s,l),f.resize(),f.setCenter(e.bbox.getCenter()),f.fitBounds(e.bbox,{duration:0}),f.on("render",function e(){f.loaded()&&(i({format:t,orientation:r,data:f.getCanvas().toDataURL("image/jpeg",1),margin:n,width:s,height:l,details:c}),f.off("render",e))}),f.on("error",function(e){f.getContainer().parentNode.removeChild(f.getContainer()),a(Error(e.message))})})}},{key:"name",get:function(){return this._details.filename}},{key:"cutouts",get:function(){return this._tracks.get("cutouts")}},{key:"style",set:function(e){this._map.setStyle(e)}}]),e}();n.default=w},{"./layers.js":10,"./mapboxtoken.js":12,"./mapcutter.js":13,"./paperformat.js":14,"./track.js":17,"./trackutils.js":18}],12:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default="pk.eyJ1IjoibWFwcGVscyIsImEiOiJjaXhnNnc3cmcwMDA4MnhvMm1iNWdlbXI0In0.mhfJZzCsroQq5dsuUg079g"},{}],13:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var a,u=e[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{!r&&u.return&&u.return()}finally{if(i)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=e("./paperformat.js"),a=r(o),u=e("./boundingbox.js"),s=r(u),l=e("./trackutils.js"),c=(r(l),function(e,t){var n=a.default.dimensions(t.format),r=i(n,2),o=r[0],u=r[1];o-=2*t.margin,u-=2*t.margin;var l=o/1e3*t.scale,c=u/1e3*t.scale,f=(o-2*t.padding)/1e3*t.scale,d=(u-2*t.padding)/1e3*t.scale,h=[],p=!0,m=!1,g=void 0;try{for(var v,y=e.features[Symbol.iterator]();!(p=(v=y.next()).done);p=!0){var b=v.value,w=new s.default(b.geometry.coordinates[0][1]),N=!0,x=!1,_=void 0;try{for(var k,E=b.geometry.coordinates[Symbol.iterator]();!(N=(k=E.next()).done);N=!0){var T=k.value,S=w.bounds;w.extend(T),w.largerThan(f,d)&&(w.revertTo(S),w.resize(l,c),h.push(w.toFeature()),w=new s.default(T[1]),w.extend(T))}}catch(e){x=!0,_=e}finally{try{!N&&E.return&&E.return()}finally{if(x)throw _}}w.resize(l,c),h.push(w.toFeature())}}catch(e){m=!0,g=e}finally{try{!p&&y.return&&y.return()}finally{if(m)throw g}}return{type:"FeatureCollection",features:h}});n.default=c},{"./boundingbox.js":7,"./paperformat.js":14,"./trackutils.js":18}],14:[function(e,t,n){"use strict";function r(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var a,u=e[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{!r&&u.return&&u.return()}finally{if(i)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=new Map;o.set("a0",[841,1189]).set("a1",[594,841]).set("a2",[420,594]).set("a3",[297,420]).set("a4",[210,297]).set("a5",[148,210]).set("a6",[105,148]).set("letter",[216,279]).set("legal",[216,356]).set("tabloid",[279,432]);var a={dimensions:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"p",r=o.get(e).map(function(e){return e-=2*t}),a=i(r,2),u=a[0],s=a[1];if("l"===n){var l=[s,u];u=l[0],s=l[1]}return[u,s]},validFormats:function(e){var t=[],n=!0,a=!1,u=void 0;try{for(var s,l=o[Symbol.iterator]();!(n=(s=l.next()).done);n=!0){var c=i(s.value,2),f=c[0],d=c[1];Math.max.apply(Math,r(d))<=e&&t.push(f)}}catch(e){a=!0,u=e}finally{try{!n&&l.return&&l.return()}finally{if(a)throw u}}return t}};n.default=a},{}],15:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t,n){return function(r){return e.cutoutMap(r,t,n)}}function o(e){var t=0,n=e.internal.getFontSize()/e.internal.scaleFactor,r=e.getStringUnitWidth("© Mapbox © OpenStreetMap")*n;return function(i){e.addPage(i.format,i.orientation),e.addImage({imageData:i.data,x:i.margin,y:i.margin,w:i.width,h:i.height,compression:"FAST",alias:"map"+t++});var o=i.margin+i.height+n;e.setTextColor(0,0,0),e.text(i.details(t),i.margin,o),e.setTextColor(105,105,105),e.text("© Mapbox © OpenStreetMap",i.margin+i.width-r,o)}}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e("./layers.js"),s=(function(e){e&&e.__esModule?e:{default:e}}(u),function(){function e(){r(this,e),this.actualPixelRatio=window.devicePixelRatio,this.canceled=!1}return a(e,[{key:"setPixelRatio",value:function(e){Object.defineProperty(window,"devicePixelRatio",{get:function(){return e/96}})}},{key:"resetPixelRatio",value:function(){var e=this;Object.defineProperty(window,"devicePixelRatio",{get:function(){return e.actualPixelRatio}})}},{key:"cancel",value:function(){console.log("Canceling"),this.canceled=!0}},{key:"generatePDF",value:function(e,t,n){var r=this;this.setPixelRatio(t.dpi),console.time("PDF generation");var a=new jspdf({compress:!0});a.setFontSize(9),a.deletePage(1);var u=i(e,t.format,t.margin),s=o(a),l=0,c=e.cutouts.features.length;n(l,c),e.cutouts.features.reduce(function(e,t){return e.then(function(){return r.canceled?Promise.reject(new Error("canceled by user")):u(t)}).then(function(e){console.time("Load map image "+l),n(l++,c,r.canceled),s(e),console.timeEnd("Load map image "+l)})},Promise.resolve()).then(function(){r.canceled||(console.log("Saving pdf"),a.save(e.name+".pdf"))}).catch(function(e){console.log("PDF generation failed: "+e.name)}).then(function(){console.timeEnd("PDF generation"),console.log("Clean up"),n(c,c,r.canceled),e.remove()})}}]),e}());n.default=s},{"./layers.js":10}],16:[function(e,t,n){(function(r){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function t(e){if(!e||!e.length)return 0;for(var t=0,n=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t)|0;return n}function o(e,t){return e.getElementsByTagName(t)}function a(e,t){return e.getAttribute(t)}function u(e,t){return parseFloat(a(e,t))}function s(e,t){var n=o(e,t);return n.length?n[0]:null}function l(e){return e.normalize&&e.normalize(),e}function c(e){for(var t=0,n=[];t<e.length;t++)n[t]=parseFloat(e[t]);return n}function f(e){return e&&l(e),e&&e.textContent||""}function d(e,t){var n,r,i={};for(r=0;r<t.length;r++)(n=s(e,t[r]))&&(i[t[r]]=f(n));return i}function h(e,t){for(var n in t)e[n]=t[n]}function p(e){return c(e.replace(w,"").split(","))}function m(e){for(var t=e.replace(N,"").split(x),n=[],r=0;r<t.length;r++)n.push(p(t[r]));return n}function g(e){var t,n=[u(e,"lon"),u(e,"lat")],r=s(e,"ele"),i=s(e,"gpxtpx:hr")||s(e,"hr"),o=s(e,"time");return r&&(t=parseFloat(f(r)),isNaN(t)||n.push(t)),{coordinates:n,time:o?f(o):null,heartRate:i?parseFloat(f(i)):null}}function v(){return{type:"FeatureCollection",features:[]}}function y(e){return void 0!==e.xml?e.xml:b.serializeToString(e)}var b,w=/\s*/g,N=/^\s*|\s*$/g,x=/\s+/;return"undefined"!=typeof XMLSerializer?b=new XMLSerializer:"object"!==(void 0===n?"undefined":i(n))||"object"!==(void 0===r?"undefined":i(r))||r.browser||(b=new(e("xmldom").XMLSerializer)),{kml:function(e){function n(e){var t,n;return e=e||"","#"===e.substr(0,1)&&(e=e.substr(1)),6!==e.length&&3!==e.length||(t=e),8===e.length&&(n=parseInt(e.substr(0,2),16)/255,t="#"+e.substr(6,2)+e.substr(4,2)+e.substr(2,2)),[t,isNaN(n)?void 0:n]}function r(e){return c(e.split(" "))}function i(e){var t=o(e,"coord","gx"),n=[],i=[];0===t.length&&(t=o(e,"gx:coord"));for(var a=0;a<t.length;a++)n.push(r(f(t[a])));for(var u=o(e,"when"),s=0;s<u.length;s++)i.push(f(u[s]));return{coords:n,times:i}}function u(e){var t,n,r,a,l,c=[],d=[];if(s(e,"MultiGeometry"))return u(s(e,"MultiGeometry"));if(s(e,"MultiTrack"))return u(s(e,"MultiTrack"));if(s(e,"gx:MultiTrack"))return u(s(e,"gx:MultiTrack"));for(r=0;r<b.length;r++)if(n=o(e,b[r]))for(a=0;a<n.length;a++)if(t=n[a],"Point"===b[r])c.push({type:"Point",coordinates:p(f(s(t,"coordinates")))});else if("LineString"===b[r])c.push({type:"LineString",coordinates:m(f(s(t,"coordinates")))});else if("Polygon"===b[r]){var h=o(t,"LinearRing"),g=[];for(l=0;l<h.length;l++)g.push(m(f(s(h[l],"coordinates"))));c.push({type:"Polygon",coordinates:g})}else if("Track"===b[r]||"gx:Track"===b[r]){var v=i(t);c.push({type:"LineString",coordinates:v.coords}),v.times.length&&d.push(v.times)}return{geoms:c,coordTimes:d}}for(var l=v(),d={},h={},g={},b=["Polygon","LineString","Point","Track","gx:Track"],w=o(e,"Placemark"),N=o(e,"Style"),x=o(e,"StyleMap"),_=0;_<N.length;_++){var k=t(y(N[_])).toString(16);d["#"+a(N[_],"id")]=k,h[k]=N[_]}for(var E=0;E<x.length;E++){d["#"+a(x[E],"id")]=t(y(x[E])).toString(16);for(var T=o(x[E],"Pair"),S={},D=0;D<T.length;D++)S[f(s(T[D],"key"))]=f(s(T[D],"styleUrl"));g["#"+a(x[E],"id")]=S}for(var C=0;C<w.length;C++)l.features=l.features.concat(function(e){var t,r=u(e),i={},l=f(s(e,"name")),c=f(s(e,"address")),p=f(s(e,"styleUrl")),m=f(s(e,"description")),v=s(e,"TimeSpan"),y=s(e,"TimeStamp"),b=s(e,"ExtendedData"),w=s(e,"LineStyle"),N=s(e,"PolyStyle"),x=s(e,"visibility");if(!r.geoms.length)return[];if(l&&(i.name=l),c&&(i.address=c),p){"#"!==p[0]&&(p="#"+p),i.styleUrl=p,d[p]&&(i.styleHash=d[p]),g[p]&&(i.styleMapHash=g[p],i.styleHash=d[g[p].normal]);var _=h[i.styleHash];_&&(w||(w=s(_,"LineStyle")),N||(N=s(_,"PolyStyle")))}if(m&&(i.description=m),v){var k=f(s(v,"begin")),E=f(s(v,"end"));i.timespan={begin:k,end:E}}if(y&&(i.timestamp=f(s(y,"when"))),w){var T=n(f(s(w,"color"))),S=T[0],D=T[1],C=parseFloat(f(s(w,"width")));S&&(i.stroke=S),isNaN(D)||(i["stroke-opacity"]=D),isNaN(C)||(i["stroke-width"]=C)}if(N){var M=n(f(s(N,"color"))),A=M[0],I=M[1],O=f(s(N,"fill")),j=f(s(N,"outline"));A&&(i.fill=A),isNaN(I)||(i["fill-opacity"]=I),O&&(i["fill-opacity"]="1"===O?i["fill-opacity"]||1:0),j&&(i["stroke-opacity"]="1"===j?i["stroke-opacity"]||1:0)}if(b){var L=o(b,"Data"),R=o(b,"SimpleData");for(t=0;t<L.length;t++)i[L[t].getAttribute("name")]=f(s(L[t],"value"));for(t=0;t<R.length;t++)i[R[t].getAttribute("name")]=f(R[t])}x&&(i.visibility=f(x)),r.coordTimes.length&&(i.coordTimes=1===r.coordTimes.length?r.coordTimes[0]:r.coordTimes);var P={type:"Feature",geometry:1===r.geoms.length?r.geoms[0]:{type:"GeometryCollection",geometries:r.geoms},properties:i};return a(e,"id")&&(P.id=a(e,"id")),[P]}(w[C]));return l},gpx:function(e){function t(e,t){var n=o(e,t),r=[],i=[],a=[],u=n.length;if(u<2)return{};for(var s=0;s<u;s++){var l=g(n[s]);r.push(l.coordinates),l.time&&i.push(l.time),l.heartRate&&a.push(l.heartRate)}return{line:r,times:i,heartRates:a}}function n(e){var t={};if(e){var n=s(e,"line");if(n){var r=f(s(n,"color")),i=parseFloat(f(s(n,"opacity"))),o=parseFloat(f(s(n,"width")));r&&(t.stroke=r),isNaN(i)||(t["stroke-opacity"]=i),isNaN(o)||(t["stroke-width"]=96*o/25.4)}}return t}function r(e){var t=d(e,["name","cmt","desc","type","time","keywords"]),n=o(e,"link");n.length&&(t.links=[]);for(var r,i=0;i<n.length;i++)r={href:a(n[i],"href")},h(r,d(n[i],["text","type"])),t.links.push(r);return t}var i,u,l=o(e,"trk"),c=o(e,"rte"),p=o(e,"wpt"),m=v();for(i=0;i<l.length;i++)(u=function(e){for(var i,a=o(e,"trkseg"),u=[],l=[],c=[],f=0;f<a.length;f++)(i=t(a[f],"trkpt"))&&(i.line&&u.push(i.line),i.times&&i.times.length&&l.push(i.times),i.heartRates&&i.heartRates.length&&c.push(i.heartRates));if(0!==u.length){var d=r(e);return h(d,n(s(e,"extensions"))),l.length&&(d.coordTimes=1===u.length?l[0]:l),c.length&&(d.heartRates=1===u.length?c[0]:c),{type:"Feature",properties:d,geometry:{type:1===u.length?"LineString":"MultiLineString",coordinates:1===u.length?u[0]:u}}}}(l[i]))&&m.features.push(u);for(i=0;i<c.length;i++)(u=function(e){var i=t(e,"rtept");if(i.line){var o=r(e);return h(o,n(s(e,"extensions"))),{type:"Feature",properties:o,geometry:{type:"LineString",coordinates:i.line}}}}(c[i]))&&m.features.push(u);for(i=0;i<p.length;i++)m.features.push(function(e){var t=r(e);return h(t,d(e,["sym"])),{type:"Feature",properties:t,geometry:{type:"Point",coordinates:g(e).coordinates}}}(p[i]));return m}}}();void 0!==t&&(t.exports=o)}).call(this,e("_process"))},{_process:3,xmldom:4}],17:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.Poi=n.Milemarkers=n.Cutouts=n.Route=void 0;var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("./mapcutter.js"),l=(r(s),e("./trackutils.js")),c=(r(l),e("./layers.js")),f=r(c),d=function(){function e(t,n){a(this,e),this._id=t,this._geojson=n||{}}return u(e,[{key:"addLayer",value:function(e){f.default.add(e,track)}},{key:"updateLayerData",value:function(e){e.getSource(this._id).setData(this._geojson)}},{key:"clearLayerData",value:function(e){e.getSource(this._id).setData({type:"FeatureCollection",features:[]})}},{key:"id",get:function(){return this._id},set:function(e){this._id=e}},{key:"minzoom",get:function(){return 0}},{key:"geojson",get:function(){return this._geojson},set:function(e){this._geojson=e}},{key:"features",get:function(){return this._geojson.features}},{key:"before",get:function(){return"housenum-label"}},{key:"layer",get:function(){}}]),e}(),h=function(e){function t(){return a(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),u(t,[{key:"layer",get:function(){return{id:this._id,source:this._id,type:"line",layout:{"line-join":"round","line-cap":"square"},paint:{"line-color":"#ff69b4","line-width":{stops:[[0,4],[12,3]]},"line-opacity":.6,"line-dasharray":{stops:[[0,[1e3,0]],[12,[2,1]]]}}}}}]),t}(d),p=function(e){function t(){return a(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),u(t,[{key:"layer",get:function(){return{id:this._id,source:this._id,type:"line",paint:{"line-color":"#444444","line-width":2,"line-offset":-3,"line-opacity":.6,"line-dasharray":{stops:[[0,[1e3,0]],[12,[3,2]]]}}}}}]),t}(d),m=function(e){function t(){return a(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),u(t,[{key:"layer",get:function(){return{id:this._id,source:this._id,type:"symbol",layout:{"icon-image":"marker-11","icon-offset":[0,-5],"text-field":"{title} km","text-anchor":"bottom","text-offset":[0,-.5],"text-size":11,"icon-ignore-placement":!0,"text-optional":!0}}}}]),t}(d),g=function(e){function t(){return a(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),u(t,[{key:"layer",get:function(){return{id:this._id,source:this._id,type:"symbol",layout:{"icon-image":this._id,"icon-ignore-placement":!0}}}}]),t}(d);n.Route=h,n.Cutouts=p,n.Milemarkers=m,n.Poi=g},{"./layers.js":10,"./mapcutter.js":13,"./trackutils.js":18}],18:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t,n){var r=t[0]-e[0],i=t[1]-e[1];return[e[0]+r*n,e[1]+i*n]}function o(e,t){return{type:"Feature",geometry:{type:"Point",coordinates:e},properties:{title:t}}}function a(e){return{type:"FeatureCollection",features:e}}function u(e,t){return e[0]>=t.getWest()&&e[0]<=t.getEast()&&e[1]>=t.getSouth()&&e[1]<=t.getNorth()}function s(e,t,n){for(var r={x:e[0],y:e[1]},i={x:t[0],y:t[1]},o=0;o<n.length-1;o++){var a={x:n[o][0],y:n[o][1]},u={x:n[o+1][0],y:n[o+1][1]},s=(u.y-a.y)*(i.x-r.x)-(u.x-a.x)*(i.y-r.y);if(0!==s){var l=((u.x-a.x)*(r.y-a.y)-(u.y-a.y)*(r.x-a.x))/s,c=((i.x-r.x)*(r.y-a.y)-(i.y-r.y)*(r.x-a.x))/s;if(0<=l&&l<=1&&0<=c&&c<=1)return[r.x+l*(i.x-r.x),r.y+l*(i.y-r.y)]}}return!1}Object.defineProperty(n,"__esModule",{value:!0});var l=e("cheap-ruler"),c=r(l),f=e("@mapbox/geojson-normalize"),d=r(f),h=e("xmldom"),p=e("./togeojson.js"),m=r(p),g={bounds:function e(t){var e=new mapboxgl.LngLatBounds;return t.features.forEach(function(t){return e.extend(t.bbox)}),e},reduce:function(e){e=(0,d.default)(e);var t=e.features.filter(function(e){if(e.geometry)return e.geometry.type.endsWith("LineString")});if(0===t.length)throw console.log("No track or route found."),new Error("No track or route found.");return a(t)},totalDistance:function(e){var t=e.features[0].geometry.coordinates,n=(0,c.default)(t[Math.trunc(t.length/2)][1]);return parseFloat(n.lineDistance(t))},elevation:function(e){var t=e.features[0].geometry.coordinates;if(!(t[0].length<3)){var n=0,r=0,i=t[0][2];return t.forEach(function(e){var t=e[2]-i;t>0?n+=t:r-=t,i=e[2]}),[Math.trunc(n),Math.trunc(r)]}},distanceInBounds:function(e,t){for(var n=t.features[0].geometry.coordinates,r=(0,c.default)(e.bbox.getCenter().lat),i=0,o=u(n[0],e.bbox),a=1;a<n.length-1;a++)if(u(n[a],e.bbox))if(o)i+=r.distance(n[a-1],n[a]);else{o=!0;var l=s(n[a-1],n[a],e.geometry.coordinates[0]),f=r.distance(n[a],l);i+=f}else if(o){var d=s(n[a-1],n[a],e.geometry.coordinates[0]),h=r.distance(n[a-1],d);i+=h;var p=r.lineDistance(n.slice(0,a))+h;return[i,p]}return o===!1?[0,0]:[i,this.totalDistance(t)]},milemarkers:function(e,t){if(t<=0)return a([]);var n=e.features[0].geometry.coordinates,r=(0,c.default)(n[Math.trunc(n.length/2)][1]),u=[],s=0,l=0;u.push(o(n[0],t*s++));for(var f=0;f<n.length-1;f++){var d=n[f],h=n[f+1],p=r.distance(d,h)
;if((l+=p)>t){var m=i(d,h,(t-(l-p))/p);u.push(o(m,t*s++)),l=r.distance(m,h)}}return u.push(o(n[n.length-1],Math.trunc(this.totalDistance(e)))),a(u)},togeojson:function(e,t){if("geojson"===e)return(0,d.default)(JSON.parse(t));if("gpx"===e)return t=(new h.DOMParser).parseFromString(t,"text/xml"),m.default[e](t);throw"Unknown file format: "+e}};n.default=g},{"./togeojson.js":16,"@mapbox/geojson-normalize":1,"cheap-ruler":2,xmldom:4}]},{},[9]);